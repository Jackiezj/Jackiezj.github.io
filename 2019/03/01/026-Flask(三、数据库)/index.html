<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Flask(三、数据库) | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="Jackiezz, Jackiezz's Blog">
  
  <meta name="description" content="022-Flask(三、数据库)1. ORM ORM 全拼Object-Relation Mapping.  中文意为 对象-关系映射.  主要实现模型对象到关系数据库数据的映射.  比如：把数据库表中每条记录映射为一个模型对象     ORM图解 /1550491711373.png)  优点 :  只需要面向对象编程, 不需要面向数据库编写代码. 对数据库的操作都转化成对类属性和方法的操作.">
<meta name="keywords" content="Flask">
<meta property="og:type" content="article">
<meta property="og:title" content="Flask(三、数据库)">
<meta property="og:url" content="https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="022-Flask(三、数据库)1. ORM ORM 全拼Object-Relation Mapping.  中文意为 对象-关系映射.  主要实现模型对象到关系数据库数据的映射.  比如：把数据库表中每条记录映射为一个模型对象     ORM图解 /1550491711373.png)  优点 :  只需要面向对象编程, 不需要面向数据库编写代码. 对数据库的操作都转化成对类属性和方法的操作.">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://www.jackiezz.com/2019/03/01/assets/PeopleInfoTable.png">
<meta property="og:image" content="https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/022-Flask(三、数据库">
<meta property="og:updated_time" content="2019-03-01T15:58:20.233Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Flask(三、数据库)">
<meta name="twitter:description" content="022-Flask(三、数据库)1. ORM ORM 全拼Object-Relation Mapping.  中文意为 对象-关系映射.  主要实现模型对象到关系数据库数据的映射.  比如：把数据库表中每条记录映射为一个模型对象     ORM图解 /1550491711373.png)  优点 :  只需要面向对象编程, 不需要面向数据库编写代码. 对数据库的操作都转化成对类属性和方法的操作.">
<meta name="twitter:image" content="https://www.jackiezz.com/2019/03/01/assets/PeopleInfoTable.png">
  
  
    <link rel="icon" href="images/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">Jackiezz&#39;s Blog</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        Jackiezz&#39;s Blog
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        Jackiezz的python之路
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="MinHow" target="_blank" href="//minhow.com">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/wongminho">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                        <a title="Weibo" target="_blank" href="//weibo.com/WongMinHo">
                            <i class="fa fa-weibo fa-2x"></i></a>
                    
                        <a title="Twitter" target="_blank" href="//twitter.com/huangminhow">
                            <i class="fa fa-twitter fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-026-Flask(三、数据库)" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      Flask(三、数据库)
    </h1>
    <div class="post-title-bar">
      <ul>
          
        <li>
          <i class="fa fa-calendar"></i>  2019-03-01
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <h1 id="022-Flask-三、数据库"><a href="#022-Flask-三、数据库" class="headerlink" title="022-Flask(三、数据库)"></a>022-Flask(三、数据库)</h1><h3 id="1-ORM"><a href="#1-ORM" class="headerlink" title="1. ORM"></a>1. ORM</h3><ul>
<li><p><strong>ORM</strong> 全拼<code>Object-Relation Mapping</code>.</p>
</li>
<li><p>中文意为 <strong>对象-关系映射</strong>.</p>
</li>
<li><p>主要实现模型对象到关系数据库数据的映射.</p>
<ul>
<li><p>比如：把数据库表中每条记录映射为一个模型对象</p>
<p><img src="/2019/03/01/026-Flask(三、数据库)/../assets/PeopleInfoTable.png" alt="img"></p>
</li>
</ul>
</li>
<li><p><strong>ORM图解</strong></p>
<p><img src="/2019/03/01/026-Flask(三、数据库)/022-Flask(三、数据库" alt="1550491711373">/1550491711373.png)</p>
</li>
<li><p><strong>优点</strong> :</p>
<ul>
<li>只需要面向对象编程, 不需要面向数据库编写代码.<ul>
<li>对数据库的操作都转化成对类属性和方法的操作.</li>
<li>不用编写各种数据库的<code>sql语句</code>.</li>
</ul>
</li>
<li>实现了数据模型与数据库的解耦, 屏蔽了不同数据库操作上的差异.<ul>
<li>不在关注用的是<code>mysql</code>、<code>oracle</code>…等.</li>
<li>通过简单的配置就可以轻松更换数据库, 而不需要修改代码.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>缺点</strong> :</p>
<ul>
<li>相比较直接使用SQL语句操作数据库,有性能损失.</li>
<li>根据对象的操作转换成SQL语句,根据查询的结果转化成对象, 在映射过程中有性能损失.</li>
</ul>
</li>
</ul>
<h3 id="2-Flask-SQLAlchemy"><a href="#2-Flask-SQLAlchemy" class="headerlink" title="2. Flask-SQLAlchemy"></a>2. Flask-SQLAlchemy</h3><ul>
<li>SQLALchemy 实际上是对数据库的抽象，让开发者不用直接和 SQL 语句打交道，而是通过 Python 对象来操作数据库，在舍弃一些性能开销的同时，换来的是开发效率的较大提升</li>
<li>SQLAlchemy是一个关系型数据库框架，它提供了高层的 ORM 和底层的原生数据库的操作。flask-sqlalchemy 是一个简化了 SQLAlchemy 操作的flask扩展。</li>
<li>文档地址：<a href="http://docs.jinkan.org/docs/flask-sqlalchemy" target="_blank" rel="noopener">http://docs.jinkan.org/docs/flask-sqlalchemy</a></li>
</ul>
<h4 id="1-安装及设置"><a href="#1-安装及设置" class="headerlink" title="1) 安装及设置"></a>1) 安装及设置</h4><ul>
<li>安装 flask-sqlalchemy</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-sqlalchemy</span><br></pre></td></tr></table></figure>
<ul>
<li>如果连接的是 mysql 数据库，需要安装 mysqldb</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-mysqldb</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>数据库连接设置</strong></p>
</li>
<li><p>在 Flask-SQLAlchemy 中，数据库使用URL指定，而且程序使用的数据库必须保存到Flask配置对象的 <strong>SQLALCHEMY_DATABASE_URI</strong> 键中</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'mysql://root:mysql@127.0.0.1:3306/test'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>其他设置：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 动态追踪修改设置，如未设置只会提示警告</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="keyword">True</span></span><br><span class="line"><span class="comment">#查询时会显示原始SQL语句</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_ECHO'</span>] = <span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<ul>
<li>配置完成需要去 MySQL 中创建项目所使用的数据库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -uroot -pmysql</span><br><span class="line">$ create database <span class="built_in">test</span> charset utf8;</span><br></pre></td></tr></table></figure>
<ul>
<li>其他配置</li>
</ul>
<table>
<thead>
<tr>
<th>名字</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>SQLALCHEMY_DATABASE_URI</td>
<td>用于连接的数据库 URI 。例如:sqlite:////tmp/test.dbmysql://username:password@server/db</td>
</tr>
<tr>
<td>SQLALCHEMY_BINDS</td>
<td>一个映射 binds 到连接 URI 的字典。更多 binds 的信息见<a href="http://docs.jinkan.org/docs/flask-sqlalchemy/binds.html#binds" target="_blank" rel="noopener"><em>用 Binds 操作多个数据库</em></a>。</td>
</tr>
<tr>
<td>SQLALCHEMY_ECHO</td>
<td>如果设置为Ture， SQLAlchemy 会记录所有 发给 stderr 的语句，这对调试有用。(打印sql语句)</td>
</tr>
<tr>
<td>SQLALCHEMY_RECORD_QUERIES</td>
<td>可以用于显式地禁用或启用查询记录。查询记录 在调试或测试模式自动启用。更多信息见get_debug_queries()。</td>
</tr>
<tr>
<td>SQLALCHEMY_NATIVE_UNICODE</td>
<td>可以用于显式禁用原生 unicode 支持。当使用 不合适的指定无编码的数据库默认值时，这对于 一些数据库适配器是必须的（比如 Ubuntu 上 某些版本的 PostgreSQL ）。</td>
</tr>
<tr>
<td>SQLALCHEMY_POOL_SIZE</td>
<td>数据库连接池的大小。默认是引擎默认值（通常 是 5 ）</td>
</tr>
<tr>
<td>SQLALCHEMY_POOL_TIMEOUT</td>
<td>设定连接池的连接超时时间。默认是 10 。</td>
</tr>
<tr>
<td>SQLALCHEMY_POOL_RECYCLE</td>
<td>多少秒后自动回收连接。这对 MySQL 是必要的， 它默认移除闲置多于 8 小时的连接。注意如果 使用了 MySQL ， Flask-SQLALchemy 自动设定 这个值为 2 小时。</td>
</tr>
</tbody>
</table>
<h4 id="2-连接其他数据库"><a href="#2-连接其他数据库" class="headerlink" title="2) 连接其他数据库"></a>2) 连接其他数据库</h4><p>完整连接 URI 列表请跳转到 SQLAlchemy 下面的文档 (<a href="http://www.sqlalchemy.org/docs/core/engines.html" target="_blank" rel="noopener">Supported Databases</a>) 。这里给出一些 常见的连接字符串。</p>
<ul>
<li>Postgres:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgresql://scott:tiger@localhost/mydatabase</span><br></pre></td></tr></table></figure>
<ul>
<li>MySQL:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql://scott:tiger@localhost/mydatabase</span><br></pre></td></tr></table></figure>
<ul>
<li>Oracle:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- oracle://scott:tiger@127.0.0.1:1521/sidname</span><br></pre></td></tr></table></figure>
<ul>
<li>SQLite （注意开头的四个斜线）:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite:////absolute/path/to/foo.db</span><br></pre></td></tr></table></figure>
<h4 id="3-SQLAlchemy字段类型"><a href="#3-SQLAlchemy字段类型" class="headerlink" title="3) SQLAlchemy字段类型"></a>3) SQLAlchemy字段类型</h4><table>
<thead>
<tr>
<th>类型名</th>
<th>python中类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Integer</td>
<td>int</td>
<td>普通整数，一般是32位</td>
</tr>
<tr>
<td>SmallInteger</td>
<td>int</td>
<td>取值范围小的整数，一般是16位</td>
</tr>
<tr>
<td>BigInteger</td>
<td>int或long</td>
<td>不限制精度的整数</td>
</tr>
<tr>
<td>Float</td>
<td>float</td>
<td>浮点数</td>
</tr>
<tr>
<td>Numeric</td>
<td>decimal.Decimal</td>
<td>普通整数，一般是32位</td>
</tr>
<tr>
<td>String</td>
<td>str</td>
<td>变长字符串</td>
</tr>
<tr>
<td>Text</td>
<td>str</td>
<td>变长字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td>Unicode</td>
<td>unicode</td>
<td>变长Unicode字符串</td>
</tr>
<tr>
<td>UnicodeText</td>
<td>unicode</td>
<td>变长Unicode字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td>Boolean</td>
<td>bool</td>
<td>布尔值</td>
</tr>
<tr>
<td>Date</td>
<td>datetime.date</td>
<td>时间</td>
</tr>
<tr>
<td>Time</td>
<td>datetime.datetime</td>
<td>日期和时间</td>
</tr>
<tr>
<td>LargeBinary</td>
<td>str</td>
<td>二进制文件</td>
</tr>
</tbody>
</table>
<h4 id="4-常用的SQLAlchemy列选项"><a href="#4-常用的SQLAlchemy列选项" class="headerlink" title="4) 常用的SQLAlchemy列选项"></a>4) 常用的SQLAlchemy列选项</h4><table>
<thead>
<tr>
<th>选项名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>primary_key</td>
<td>如果为True，代表表的主键</td>
</tr>
<tr>
<td>unique</td>
<td>如果为True，代表这列不允许出现重复的值</td>
</tr>
<tr>
<td>index</td>
<td>如果为True，为这列创建索引，提高查询效率</td>
</tr>
<tr>
<td>nullable</td>
<td>如果为True，允许有空值，如果为False，不允许有空值</td>
</tr>
<tr>
<td>default</td>
<td>为这列定义默认值</td>
</tr>
</tbody>
</table>
<h4 id="5-常用的SQLAlchemy关系选项"><a href="#5-常用的SQLAlchemy关系选项" class="headerlink" title="5) 常用的SQLAlchemy关系选项"></a>5) 常用的SQLAlchemy关系选项</h4><table>
<thead>
<tr>
<th>选项名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>backref</td>
<td>在关系的另一模型中添加反向引用</td>
</tr>
<tr>
<td>primary join</td>
<td>明确指定两个模型之间使用的联结条件</td>
</tr>
<tr>
<td>uselist</td>
<td>如果为False，不使用列表，而使用标量值</td>
</tr>
<tr>
<td>order_by</td>
<td>指定关系中记录的排序方式</td>
</tr>
<tr>
<td>secondary</td>
<td>指定多对多关系中关系表的名字</td>
</tr>
<tr>
<td>secondary join</td>
<td>在SQLAlchemy中无法自行决定时，指定多对多关系中的二级联结条件</td>
</tr>
</tbody>
</table>
<h3 id="3-数据库基本操作"><a href="#3-数据库基本操作" class="headerlink" title="3. 数据库基本操作"></a>3. 数据库基本操作</h3><ul>
<li>在Flask-SQLAlchemy中，插入、修改、删除操作，均由数据库会话管理。<ul>
<li>会话用 db.session 表示。在准备把数据写入数据库前，要先将数据添加到会话中然后调用 commit() 方法提交会话。</li>
</ul>
</li>
<li>在 Flask-SQLAlchemy 中，查询操作是通过 query 对象操作数据。<ul>
<li>最基本的查询是返回表中所有数据，可以通过过滤器进行更精确的数据库查询。</li>
</ul>
</li>
</ul>
<h4 id="1-在视图函数中定义模型类"><a href="#1-在视图函数中定义模型类" class="headerlink" title="1) 在视图函数中定义模型类"></a>1) 在视图函数中定义模型类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置连接数据库的URL</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'mysql://root:mysql@127.0.0.1:3306/test'</span></span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="keyword">True</span></span><br><span class="line"><span class="comment">#查询时会显示原始SQL语句</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_ECHO'</span>] = <span class="keyword">True</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 定义表名</span></span><br><span class="line">    __tablename__ = <span class="string">'roles'</span></span><br><span class="line">    <span class="comment"># 定义列对象</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">64</span>), unique=<span class="keyword">True</span>)</span><br><span class="line">    us = db.relationship(<span class="string">'User'</span>, backref=<span class="string">'role'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#repr()方法显示一个可读字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Role:%s'</span>% self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'users'</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">64</span>), unique=<span class="keyword">True</span>, index=<span class="keyword">True</span>)</span><br><span class="line">    email = db.Column(db.String(<span class="number">64</span>),unique=<span class="keyword">True</span>)</span><br><span class="line">    password = db.Column(db.String(<span class="number">64</span>))</span><br><span class="line">    role_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'roles.id'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'User:%s'</span>%self.name</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-模型之前的关联"><a href="#2-模型之前的关联" class="headerlink" title="2) 模型之前的关联"></a>2) 模型之前的关联</h4><h5 id="1-gt-一对多"><a href="#1-gt-一对多" class="headerlink" title="1&gt; 一对多"></a>1&gt; 一对多</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">#关键代码</span></span><br><span class="line">    us = db.relationship(<span class="string">'User'</span>, backref=<span class="string">'role'</span>, lazy=<span class="string">'dynamic'</span>)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    role_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'roles.id'</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>其中realtionship描述了Role和User的关系。在此文中，第一个参数为对应参照的类”User”</li>
<li>第二个参数backref为类User申明新属性的方法</li>
<li>第三个参数lazy决定了什么时候SQLALchemy从数据库中加载数据<ul>
<li>如果设置为子查询方式(subquery)，则会在加载完Role对象后，就立即加载与其关联的对象，这样会让总查询数量减少，但如果返回的条目数量很多，就会比较慢<ul>
<li>设置为 subquery 的话，role.users 返回所有数据列表</li>
</ul>
</li>
<li>另外,也可以设置为动态方式(dynamic)，这样关联对象会在被使用的时候再进行加载，并且在返回前进行过滤，如果返回的对象数很多，或者未来会变得很多，那最好采用这种方式<ul>
<li>设置为 dynamic 的话，role.users 返回查询对象，并没有做真正的查询，可以利用查询对象做其他逻辑，比如：先排序再返回结果</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-gt-多对多"><a href="#2-gt-多对多" class="headerlink" title="2&gt; 多对多"></a>2&gt; 多对多</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">registrations = db.Table(<span class="string">'registrations'</span>,  </span><br><span class="line">    db.Column(<span class="string">'student_id'</span>, db.Integer, db.ForeignKey(<span class="string">'students.id'</span>)),  </span><br><span class="line">    db.Column(<span class="string">'course_id'</span>, db.Integer, db.ForeignKey(<span class="string">'courses.id'</span>))  </span><br><span class="line">)  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Course</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    ...</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    courses = db.relationship(<span class="string">'Course'</span>,secondary=registrations,  </span><br><span class="line">                                    backref=<span class="string">'students'</span>,  </span><br><span class="line">                                    lazy=<span class="string">'dynamic'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="3-常用的SQLAlchemy查询过滤器"><a href="#3-常用的SQLAlchemy查询过滤器" class="headerlink" title="3) 常用的SQLAlchemy查询过滤器"></a>3) 常用的SQLAlchemy查询过滤器</h4><table>
<thead>
<tr>
<th>过滤器</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>filter()</td>
<td>把过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td>filter_by()</td>
<td>把等值过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td>limit</td>
<td>使用指定的值限定原查询返回的结果</td>
</tr>
<tr>
<td>offset()</td>
<td>偏移原查询返回的结果，返回一个新查询</td>
</tr>
<tr>
<td>order_by()</td>
<td>根据指定条件对原查询结果进行排序，返回一个新查询</td>
</tr>
<tr>
<td>group_by()</td>
<td>根据指定条件对原查询结果进行分组，返回一个新查询</td>
</tr>
</tbody>
</table>
<h4 id="4-常用的SQLAlchemy查询执行器"><a href="#4-常用的SQLAlchemy查询执行器" class="headerlink" title="4) 常用的SQLAlchemy查询执行器"></a>4) 常用的SQLAlchemy查询执行器</h4><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>all()</td>
<td>以列表形式返回查询的所有结果</td>
</tr>
<tr>
<td>first()</td>
<td>返回查询的第一个结果，如果未查到，返回None</td>
</tr>
<tr>
<td>first_or_404()</td>
<td>返回查询的第一个结果，如果未查到，返回404</td>
</tr>
<tr>
<td>get()</td>
<td>返回指定主键对应的行，如不存在，返回None</td>
</tr>
<tr>
<td>get_or_404()</td>
<td>返回指定主键对应的行，如不存在，返回404</td>
</tr>
<tr>
<td>count()</td>
<td>返回查询结果的数量</td>
</tr>
<tr>
<td>paginate()</td>
<td>返回一个Paginate对象，它包含指定范围内的结果</td>
</tr>
</tbody>
</table>
<h4 id="5-创建表："><a href="#5-创建表：" class="headerlink" title="5) 创建表："></a>5) 创建表：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.create_all()</span><br></pre></td></tr></table></figure>
<h4 id="6-删除表"><a href="#6-删除表" class="headerlink" title="6) 删除表"></a>6) 删除表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.drop_all()</span><br></pre></td></tr></table></figure>
<h4 id="7-插入一条数据"><a href="#7-插入一条数据" class="headerlink" title="7) 插入一条数据"></a>7) 插入一条数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ro1 = Role(name=&apos;admin&apos;)</span><br><span class="line">db.session.add(ro1)</span><br><span class="line">db.session.commit()</span><br><span class="line">#再次插入一条数据</span><br><span class="line">ro2 = Role(name=&apos;user&apos;)</span><br><span class="line">db.session.add(ro2)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>
<h4 id="8-一次插入多条数据"><a href="#8-一次插入多条数据" class="headerlink" title="8) 一次插入多条数据"></a>8) 一次插入多条数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">us1 = User(name=<span class="string">'wang'</span>,email=<span class="string">'wang@163.com'</span>,password=<span class="string">'123456'</span>,role_id=ro1.id)</span><br><span class="line">us2 = User(name=<span class="string">'zhang'</span>,email=<span class="string">'zhang@189.com'</span>,password=<span class="string">'201512'</span>,role_id=ro2.id)</span><br><span class="line">us3 = User(name=<span class="string">'chen'</span>,email=<span class="string">'chen@126.com'</span>,password=<span class="string">'987654'</span>,role_id=ro2.id)</span><br><span class="line">us4 = User(name=<span class="string">'zhou'</span>,email=<span class="string">'zhou@163.com'</span>,password=<span class="string">'456789'</span>,role_id=ro1.id)</span><br><span class="line">us5 = User(name=<span class="string">'tang'</span>,email=<span class="string">'tang@itheima.com'</span>,password=<span class="string">'158104'</span>,role_id=ro2.id)</span><br><span class="line">us6 = User(name=<span class="string">'wu'</span>,email=<span class="string">'wu@gmail.com'</span>,password=<span class="string">'5623514'</span>,role_id=ro2.id)</span><br><span class="line">us7 = User(name=<span class="string">'qian'</span>,email=<span class="string">'qian@gmail.com'</span>,password=<span class="string">'1543567'</span>,role_id=ro1.id)</span><br><span class="line">us8 = User(name=<span class="string">'liu'</span>,email=<span class="string">'liu@itheima.com'</span>,password=<span class="string">'867322'</span>,role_id=ro1.id)</span><br><span class="line">us9 = User(name=<span class="string">'li'</span>,email=<span class="string">'li@163.com'</span>,password=<span class="string">'4526342'</span>,role_id=ro2.id)</span><br><span class="line">us10 = User(name=<span class="string">'sun'</span>,email=<span class="string">'sun@163.com'</span>,password=<span class="string">'235523'</span>,role_id=ro2.id)</span><br><span class="line">db.session.add_all([us1,us2,us3,us4,us5,us6,us7,us8,us9,us10])</span><br><span class="line">db.session.commit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">查询所有用户数据</span></span><br><span class="line"><span class="string">查询有多少个用户</span></span><br><span class="line"><span class="string">查询第1个用户</span></span><br><span class="line"><span class="string">查询id为4的用户[3种方式]</span></span><br><span class="line"><span class="string">查询名字结尾字符为g的所有数据[开始/包含]</span></span><br><span class="line"><span class="string">查询名字不等于wang的所有数据[2种方式]</span></span><br><span class="line"><span class="string">查询名字和邮箱都以 li 开头的所有数据[2种方式]</span></span><br><span class="line"><span class="string">查询password是 `123456` 或者 `email` 以 `itheima.com` 结尾的所有数据</span></span><br><span class="line"><span class="string">查询id为 [1, 3, 5, 7, 9] 的用户列表</span></span><br><span class="line"><span class="string">查询name为liu的角色数据</span></span><br><span class="line"><span class="string">查询所有用户数据，并以邮箱排序</span></span><br><span class="line"><span class="string">每页3个，查询第2页的数据</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h4 id="9-查询-filter-by精确查询"><a href="#9-查询-filter-by精确查询" class="headerlink" title="9) 查询:filter_by精确查询"></a>9) 查询:filter_by精确查询</h4><p>返回名字等于wang的所有人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.filter_by(name=&apos;wang&apos;).all()</span><br></pre></td></tr></table></figure>
<h4 id="10-first-返回查询到的第一个对象"><a href="#10-first-返回查询到的第一个对象" class="headerlink" title="10) first()返回查询到的第一个对象"></a>10) first()返回查询到的第一个对象</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.first()</span><br></pre></td></tr></table></figure>
<h4 id="11-all-返回查询到的所有对象"><a href="#11-all-返回查询到的所有对象" class="headerlink" title="11) all()返回查询到的所有对象"></a>11) all()返回查询到的所有对象</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.all()</span><br></pre></td></tr></table></figure>
<h4 id="12-filter模糊查询，返回名字结尾字符为g的所有数据。"><a href="#12-filter模糊查询，返回名字结尾字符为g的所有数据。" class="headerlink" title="12) filter模糊查询，返回名字结尾字符为g的所有数据。"></a>12) filter模糊查询，返回名字结尾字符为g的所有数据。</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.filter(User.name.endswith(<span class="string">'g'</span>)).all()</span><br></pre></td></tr></table></figure>
<h4 id="13-get-参数为主键，如果主键不存在没有返回内容"><a href="#13-get-参数为主键，如果主键不存在没有返回内容" class="headerlink" title="13) get():参数为主键，如果主键不存在没有返回内容"></a>13) get():参数为主键，如果主键不存在没有返回内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.get()</span><br></pre></td></tr></table></figure>
<h4 id="14-逻辑非，返回名字不等于wang的所有数据"><a href="#14-逻辑非，返回名字不等于wang的所有数据" class="headerlink" title="14) 逻辑非，返回名字不等于wang的所有数据"></a>14) 逻辑非，返回名字不等于wang的所有数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.filter(User.name!=<span class="string">'wang'</span>).all()</span><br></pre></td></tr></table></figure>
<h4 id="15-not-相当于取反"><a href="#15-not-相当于取反" class="headerlink" title="15) not_ 相当于取反"></a>15) not_ 相当于取反</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> not_</span><br><span class="line">User.query.filter(not_(User.name==<span class="string">'chen'</span>)).all()</span><br></pre></td></tr></table></figure>
<h4 id="16-逻辑与，需要导入and，返回and-条件满足的所有数据"><a href="#16-逻辑与，需要导入and，返回and-条件满足的所有数据" class="headerlink" title="16) 逻辑与，需要导入and，返回and()条件满足的所有数据"></a>16) 逻辑与，需要导入and，返回and()条件满足的所有数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> and_</span><br><span class="line">User.query.filter(and_(User.name!=<span class="string">'wang'</span>,User.email.endswith(<span class="string">'163.com'</span>))).all()</span><br></pre></td></tr></table></figure>
<h4 id="17-逻辑或，需要导入or"><a href="#17-逻辑或，需要导入or" class="headerlink" title="17) 逻辑或，需要导入or_"></a>17) 逻辑或，需要导入or_</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> or_</span><br><span class="line">User.query.filter(or_(User.name!=<span class="string">'wang'</span>,User.email.endswith(<span class="string">'163.com'</span>))).all()</span><br></pre></td></tr></table></figure>
<h4 id="18-查询数据后删除"><a href="#18-查询数据后删除" class="headerlink" title="18) 查询数据后删除"></a>18) 查询数据后删除</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = User.query.first()</span><br><span class="line">db.session.delete(user)</span><br><span class="line">db.session.commit()</span><br><span class="line">User.query.all()</span><br></pre></td></tr></table></figure>
<h4 id="19-更新数据"><a href="#19-更新数据" class="headerlink" title="19) 更新数据"></a>19) 更新数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = User.query.first()</span><br><span class="line">user.name = <span class="string">'dong'</span></span><br><span class="line">db.session.commit()</span><br><span class="line">User.query.first()</span><br></pre></td></tr></table></figure>
<h4 id="20-关联查询示例："><a href="#20-关联查询示例：" class="headerlink" title="20) 关联查询示例："></a>20) 关联查询示例：</h4><blockquote>
<p>角色和用户的关系是一对多的关系，一个角色可以有多个用户，一个用户只能属于一个角色。</p>
</blockquote>
<ul>
<li>查询角色的所有用户</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询roles表id为1的角色</span></span><br><span class="line">ro1 = Role.query.get(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#查询该角色的所有用户</span></span><br><span class="line">ro1.us.all()</span><br></pre></td></tr></table></figure>
<ul>
<li>查询用户所属角色</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询users表id为3的用户</span></span><br><span class="line">us1 = User.query.get(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#查询用户属于什么角色</span></span><br><span class="line">us1.role</span><br></pre></td></tr></table></figure>

            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2019年03月01日 23:58</p>
        <p>原始链接： <a class="post-url" href="/2019/03/01/026-Flask(三、数据库)/" title="Flask(三、数据库)">https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/</a></p>
        <footer>
            <a href="https://www.jackiezz.com">
                <img src="/images/logo.png" alt="John Doe">
                John Doe
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我吃糖~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat_code.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/images/wechat_code.jpg">
                <img class="reward-select-item-wechat" src="/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/images/alipay_code.jpg">
                <img class="reward-select-item-alipay" src="/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/&title=《Flask(三、数据库)》 — Hexo&pic=https://www.jackiezz.comimages/logo.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/&title=《Flask(三、数据库)》 — Hexo&source=" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Flask(三、数据库)》 — Hexo&url=https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/&via=https://www.jackiezz.com" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://www.jackiezz.com/2019/03/01/026-Flask(三、数据库)/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/Flask/" class="color1">Flask</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#022-Flask-三、数据库"><span class="post-toc-text">022-Flask(三、数据库)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ORM"><span class="post-toc-text">1. ORM</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Flask-SQLAlchemy"><span class="post-toc-text">2. Flask-SQLAlchemy</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-安装及设置"><span class="post-toc-text">1) 安装及设置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-连接其他数据库"><span class="post-toc-text">2) 连接其他数据库</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-SQLAlchemy字段类型"><span class="post-toc-text">3) SQLAlchemy字段类型</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-常用的SQLAlchemy列选项"><span class="post-toc-text">4) 常用的SQLAlchemy列选项</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-常用的SQLAlchemy关系选项"><span class="post-toc-text">5) 常用的SQLAlchemy关系选项</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-数据库基本操作"><span class="post-toc-text">3. 数据库基本操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-在视图函数中定义模型类"><span class="post-toc-text">1) 在视图函数中定义模型类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-模型之前的关联"><span class="post-toc-text">2) 模型之前的关联</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-gt-一对多"><span class="post-toc-text">1&gt; 一对多</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-gt-多对多"><span class="post-toc-text">2&gt; 多对多</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-常用的SQLAlchemy查询过滤器"><span class="post-toc-text">3) 常用的SQLAlchemy查询过滤器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-常用的SQLAlchemy查询执行器"><span class="post-toc-text">4) 常用的SQLAlchemy查询执行器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-创建表："><span class="post-toc-text">5) 创建表：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6-删除表"><span class="post-toc-text">6) 删除表</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-插入一条数据"><span class="post-toc-text">7) 插入一条数据</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#8-一次插入多条数据"><span class="post-toc-text">8) 一次插入多条数据</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-查询-filter-by精确查询"><span class="post-toc-text">9) 查询:filter_by精确查询</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-first-返回查询到的第一个对象"><span class="post-toc-text">10) first()返回查询到的第一个对象</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-all-返回查询到的所有对象"><span class="post-toc-text">11) all()返回查询到的所有对象</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#12-filter模糊查询，返回名字结尾字符为g的所有数据。"><span class="post-toc-text">12) filter模糊查询，返回名字结尾字符为g的所有数据。</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-get-参数为主键，如果主键不存在没有返回内容"><span class="post-toc-text">13) get():参数为主键，如果主键不存在没有返回内容</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#14-逻辑非，返回名字不等于wang的所有数据"><span class="post-toc-text">14) 逻辑非，返回名字不等于wang的所有数据</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#15-not-相当于取反"><span class="post-toc-text">15) not_ 相当于取反</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#16-逻辑与，需要导入and，返回and-条件满足的所有数据"><span class="post-toc-text">16) 逻辑与，需要导入and，返回and()条件满足的所有数据</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#17-逻辑或，需要导入or"><span class="post-toc-text">17) 逻辑或，需要导入or_</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#18-查询数据后删除"><span class="post-toc-text">18) 查询数据后删除</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#19-更新数据"><span class="post-toc-text">19) 更新数据</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#20-关联查询示例："><span class="post-toc-text">20) 关联查询示例：</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/2019/03/01/000-source/vue/vue/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          (no title)
        
      </span>
    </a>
  
  
    <a href="/2019/03/01/025-Flask(二、模板)/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">Flask(二、模板)</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2019 John Doe<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "https://www.jackiezz.com",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/Database/">Database</a><a class="category-link" href="/categories/Markdown/">Markdown</a><a class="category-link" href="/categories/前端/">前端</a><a class="category-link" href="/categories/博客/">博客</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/Flask/" style="font-size: 20px;">Flask</a> <a href="/tags/HTML-CSS/" style="font-size: 20px;">HTML&CSS</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jquery/" style="font-size: 15px;">jquery</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/Flask/" style="font-size: 20px;">Flask</a> <a href="/tags/HTML-CSS/" style="font-size: 20px;">HTML&CSS</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jquery/" style="font-size: 15px;">jquery</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/js/animate.js"></script>


  <script src="/js/pop-img.js"></script>
  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>